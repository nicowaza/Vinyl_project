{"version":3,"sources":["webpack:///webpack/bootstrap 3a8530c105848db710c6","webpack:///external \"mongoose\"","webpack:///external \"express\"","webpack:///external \"body-parser\"","webpack:///./src/models/user.js","webpack:///external \"bcryptjs\"","webpack:///external \"path\"","webpack:///external \"express-validator\"","webpack:///external \"connect-flash\"","webpack:///external \"multer\"","webpack:///./src/routes/users.js","webpack:///external \"passport\"","webpack:///./src/index.js","webpack:///external \"dotenv/config\"","webpack:///external \"volleyball\"","webpack:///external \"express-session\"","webpack:///./src/routes/vinyls.js","webpack:///./src/models/vinyl.js","webpack:///external \"express-validator/check\"","webpack:///external \"passport-local\"","webpack:///external \"express-messages\""],"names":["Schema","mongoose","UserSchema","name","type","String","username","index","email","password","avatar","pre","next","user","bcrypt","genSalt","err","salt","hash","console","log","User","model","userRouter","express","Router","check","validationResult","require","storage","multer","diskStorage","destination","req","file","cb","filename","originalname","Date","now","path","extname","upload","post","single","res","body","save","flash","redirect","session","userId","_id","get","render","title","passport","authenticate","successRedirect","failureRedirect","failureFlash","logout","SERVER_PORT","DBUrl","process","env","app","LocalStrategy","Strategy","url","options","promiseLibrary","Promise","connect","db","connection","on","use","bodyParser","json","urlencoded","extended","static","set","secret","resave","saveUninitialized","cookie","secure","locals","messages","initialize","serializeUser","done","id","deserializeUser","findById","findOne","message","compare","isMatch","join","__dirname","PORT","listen","vinylRouter","ensureAuthenticated","isAuthenticated","vinyl","artist","release","format","description","author","cover","Vinyl","params","query","update","remove","find","userVinyls","vinyls","allVinyls","VinylSchema"],"mappings":"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","file":"main.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 11);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 3a8530c105848db710c6","module.exports = require(\"mongoose\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"mongoose\"\n// module id = 0\n// module chunks = 0","module.exports = require(\"express\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"express\"\n// module id = 1\n// module chunks = 0","module.exports = require(\"body-parser\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"body-parser\"\n// module id = 2\n// module chunks = 0","import mongoose from 'mongoose'\nimport bcrypt from 'bcryptjs'\n\nconst Schema = mongoose.Schema\n\nconst UserSchema = new Schema({\n  name      : { type: String },\n  username  : { type: String, index: true },\n  email     : { type: String },\n  password  : { type: String },\n  avatar    : { type: String }\n})\n\n\n// //authenticate input\n// UserSchema.statics.authenticate = function(username, password, callback){\n//   User.findOne({username: username })\n//     .exec(function (err, user) {\n//       if(err){\n//         console.log(err)\n//         return callback(error)\n//       }else if (!user){\n//         var err = new Error('User not found')\n//         err.status = 401\n//         return callback(err)\n//       }\n//       bcrypt.compare(password, user.password, function(error, result) {\n//         if(result === true){\n//           return callback(null, user)\n//         }else{\n//           return callback()\n//         }\n//     })\n// })\n// }\n\n// Hashage bcrypt qui s'active avant le user save dans la route user\nUserSchema.pre('save', function(next) {\n  const user = this\n  bcrypt.genSalt(10, function(err, salt) {\n    bcrypt.hash(user.password, salt, (err, hash) => {\n      if(err){\n        console.log(err)\n      }\n      else{\n        user.password = hash\n          next()\n      }\n    })\n  })\n})\n\n\nconst User = mongoose.model(\"User\", UserSchema)\n\nexport{ User }\n\n\n\n// WEBPACK FOOTER //\n// ./src/models/user.js","module.exports = require(\"bcryptjs\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"bcryptjs\"\n// module id = 4\n// module chunks = 0","module.exports = require(\"path\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"path\"\n// module id = 5\n// module chunks = 0","module.exports = require(\"express-validator\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"express-validator\"\n// module id = 6\n// module chunks = 0","module.exports = require(\"connect-flash\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"connect-flash\"\n// module id = 7\n// module chunks = 0","module.exports = require(\"multer\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"multer\"\n// module id = 8\n// module chunks = 0","import express from 'express'\nconst userRouter = express.Router()\nimport mongoose from 'mongoose'\nimport { User } from '../models/user'\nimport multer from 'multer'\nimport path from 'path'\nimport passport from 'passport'\nimport expressValidator from 'express-validator'\nconst { check, validationResult } = require('express-validator/check');\nimport bcrypt from 'bcryptjs'\n\n\n\nimport bodyParser from 'body-parser'\n//création de l'espace de storage pour les files uploaded dans les formulaires add et edit\nconst storage = multer.diskStorage({\n  destination : (req, file, cb) => {\n    cb(null, './public/uploads/users')\n  },\n  filename : (req, file, cb) => {\n    cb(null, file.originalname + '-' + Date.now() + path.extname(file.originalname))\n  }\n})\n\nconst upload = multer({\n  storage: storage})\n\n\n// register process\nuserRouter.post(\"/register\", upload.single('avatar'), (req, res, next) => {\n  let user = new User(req.body)\n\n    if(req.file){\n      console.log('uploading')\n      user.avatar=req.file.filename\n    }\n      else{\n        user.avatar=\"no avatar\"\n      }\n\n    user.save((err, user) => {\n      if(err){\n        console.log(err)\n        req.flash('danger', 'Oops something went wrong')\n        res.redirect('/users/register')\n      } else {\n        console.log(user)\n        req.session.userId = user._id\n        req.flash('success', `'User ${user.username} created'`) /*on utilise le type success pour la couleur bootstrap et on écrit le message a afficher*/\n        res.redirect('/users/login')\n      }\n    })\n\n  })\n\nuserRouter.get(\"/register\", (req, res) => {\n  res.render('register', {title:'Register'})\n})\n\n// login process\nuserRouter.post('/login', (req, res, next) => {\n  passport.authenticate('local', {\n    successRedirect: '/vinyls/user',\n    failureRedirect: '/users/login',\n    failureFlash: true\n  })(req, res, next)\n})\n//   if (req.body.username && req.body.password) {\n//     User.authenticate(req.body.username, req.body.password, function(err, user){\n//       if (err || !user){\n//         var err = new Error('Wrong username or password')\n//         err.status = 401\n//         return next(err)\n//       }else {\n//         req.session.userId = user._id\n//         return res.redirect('/vinyls')\n//       }\n//     })\n//\n//   } else {\n//        var err = new Error('Username and password required')\n//        err.status = 401\n//        req.flash('danger', 'Username and password required')\n//        res.redirect('login')\n//        console.log(err)\n//      }\n// })\nuserRouter.get('/login', (req, res) => {\n  res.render('login', {title: 'Login'})\n})\n\nuserRouter.get('/logout', (req, res) => {\n  req.logout()\n  req.flash('success', 'You are logged out')\n  res.redirect('/users/login')\n});\n\n\nexport { userRouter }\n\n\n\n// WEBPACK FOOTER //\n// ./src/routes/users.js","module.exports = require(\"passport\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"passport\"\n// module id = 10\n// module chunks = 0","import express from 'express'\nconst { SERVER_PORT, DBUrl } = process.env\nconst app = express()\nimport bodyParser from 'body-parser'\nimport \"dotenv/config\"\nimport volleyball from 'volleyball'\nimport expressValidator from 'express-validator'\nimport flash from 'connect-flash'\nimport session from 'express-session'\nimport { vinylRouter } from './routes/vinyls'\nimport { userRouter } from './routes/users'\nimport { User } from './models/user'\nimport mongoose from 'mongoose'\nimport path from 'path'\nconst passport = require('passport')\nconst LocalStrategy = require('passport-local').Strategy;\nimport bcrypt from 'bcryptjs'\n\n\n\nconst url = DBUrl\nconst options = {\n  promiseLibrary: Promise,\n  // useMongoClient: true\n}\n\nmongoose.connect(url, options)\nlet db=mongoose.connection\n// check Db connect;'ion\nmongoose.connection.on('connected', () =>\nconsole.log('[MongoDB] is running on port 27017')\n)\n\n//check for Db errors\ndb.on('error', (err) => {\n  console.log('toto')\n})\n\n\napp.use(bodyParser.json())\napp.use(bodyParser.urlencoded({ extended: true}))\n\n// Set public folder\napp.use(express.static(/*path.join(__dirname, */'public'));\n\n//express session middleware\napp.set('trust proxy', 1) // trust first proxy\napp.use(session({\n  secret: 'keyboard cat',\n  resave: true,\n  saveUninitialized: true,\n  cookie: { secure: true }\n}))\n\n//express messages middleware\napp.use(require('connect-flash')());\napp.use(function (req, res, next) {\n  res.locals.messages = require('express-messages')(req, res);\n  next();\n});\n\n// Passport config\napp.use(passport.initialize())\napp.use(passport.session())\n\napp.get('*', (req, res, next) => {\n  res.locals.user = req.user || null\n  next()\n}) /*set une variable globale user que l'on pourra utiliser dans tous le projet*/\n/*next() apl le prochain middleware*/\n\npassport.serializeUser((user,done) => {\n  done(null, user.id)\n})\npassport.deserializeUser((id,done) => {\n  User.findById(id,(err,user) => {\n    done(null,user)\n  })\n})\n\npassport.use(new LocalStrategy(\n  function(username, password, done){\n    User.findOne({ username: username },/*ce qu'on veut comparer*/ function(err, user){\n      if(err) { return done(err); }\n      if(!user){\n        return done(null, false, { message: 'No user found.' });\n      }\n\n\n      // Match password\n      bcrypt.compare(password, user.password, function(err, isMatch) {\n        if(err) throw err\n        if(isMatch){\n          return done(null, user)\n        } else {\n            return done(null, false, { message: 'Wrong password' });\n        }\n      })\n    })\n  }))\n\n\napp.set('views', path.join(__dirname, 'views'))\napp.set('view engine', 'pug')\n\napp.use('/users', userRouter)\n// app.use('/vinyls', vinylRouter)\napp.use('/vinyls', vinylRouter)\n\napp.get('/', (req, res) => {\n  console.log('ça marche')\n  res.render('home')\n})\n\n// app.get('/', (req, res) => {\n//   let articles = [\n//     {\n//       id: 1,\n//       title:'Article 1',\n//       author: 'Nico',\n//       body:'this is article one'\n//     },\n//     {\n//       id: 2,\n//       title:'Article 2',\n//       author: 'jojo',\n//       body:'this is article two'\n//     },\n//     {\n//       id: 3,\n//       title:'Article 3',\n//       author: 'Bobo',\n//       body:'this is article three'\n//     },\n//     {\n//       id: 4,\n//       title:'Article 4',\n//       author: 'Jo',\n//       body:'this is article four'\n//     },\n//   ]\n//   res.render('home', /*dans le render on met le nom du fichier pug dans lequel on va rendre les données. On ajoute alors un objet qui contient la clé de ce que l'on renvoie dans pug et la valeur qui y fait référence*/\n//    {\n//     title: 'Articles', /*ici on appelera la clé title dans pug et pug affichera la valeur Article*/\n//     articles:articles /*ici on appelera la clé articles dans pug et celle ci renverra la valeur articles qui est un array. Il faudra introduire dans pug un loop pour naviguer dans l'array*/\n//   })\n// })\n\n// app.get('/friends', (req, res) => {\n//   const friends = [\"tony\", \"miranda\", \"jojo\", \"pierre\", \"basil\"]\n//   res.render('friends', {friends: friends});\n// })\nconsole.log(process.env.PORT)\napp.listen(process.env.PORT || SERVER_PORT, () => console.log(`[Express] is running on ${SERVER_PORT}`))\n\n\n\n// WEBPACK FOOTER //\n// ./src/index.js","module.exports = require(\"dotenv/config\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"dotenv/config\"\n// module id = 13\n// module chunks = 0","module.exports = require(\"volleyball\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"volleyball\"\n// module id = 14\n// module chunks = 0","module.exports = require(\"express-session\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"express-session\"\n// module id = 15\n// module chunks = 0","import express from 'express';\nconst vinylRouter = express.Router();\nimport { Vinyl } from '../models/vinyl'\nimport { User } from '../models/user'\nimport multer from 'multer'\nimport path from 'path'\nimport { userRouter } from './users'\n\nimport bodyParser from 'body-parser'\n//création de l'espace de storage pour les files uploaded dans les formulaires add et edit\nconst storage = multer.diskStorage({\n  destination : (req, file, cb) => {\n    cb(null, './public/uploads/')\n  },\n  filename : (req, file, cb) => {\n    cb(null, Date.now() + '-' + file.originalname)\n  }\n})\n\nconst upload = multer({\n  storage: storage}) /*on récupère la variable storage qui défini l'espace de stockage*/\n\n//on crée un Router pour toutes les routes ayant a trait aux vinyls\n\n// vinylRouter.get('/', /*cette route '/' correspond à '/vinyls' puisqu'on se trouve déjà dans la route vinyls*/ (req,res) => {\n//   // Vinyl.find({},(err,vinyls)=> {\n// //   //   if (err) res.send(err)\n// //   //     res.render(\"allvinyls\")\n// //   })\n// // }\n// Acces Control\nfunction ensureAuthenticated(req, res, next){\n  if(req.isAuthenticated()){\n    return next()\n  } else {\n    req.flash('danger', 'Please login')\n    res.redirect('/users/login')\n  }\n}\n\n//Add submit POST route\nvinylRouter.post('/add_vinyls', ensureAuthenticated, upload.single('cover'), (req, res) => {\n  console.log(req.body)\n  console.log(req.file)\n\n  let vinyl = new Vinyl()\n  vinyl.title = req.body.title\n  vinyl.artist = req.body.artist\n  vinyl.release = req.body.release\n  vinyl.format = req.body.format\n  vinyl.description = req.body.description\n  vinyl.author = req.user._id /*ici on inscrit l'id du user qui est logué dans le vinyl que l'ont enregistre dans la base de données*/\n  if(req.file){\n    vinyl.cover=req.file.filename\n  }\n    else{\n      vinyl.cover=\"no cover\"\n    }\n\n    //AUTRE METHODE\n    // const datas = req.body\n    // datas['cover'] = req.file\n\n  vinyl.save( (err, vinyl) => {\n  if(err){\n    req.flash('danger', 'Oops something went wrong')\n    res.redirect('/add_vinyls')\n  } else {\n    console.log(vinyl)\n    req.flash('success', `'${vinyl.title} added'`) /*on utilise le type success pour la couleur bootstrap et on écrit le message a afficher*/\n    res.redirect('/vinyls/user')\n  }\n  })\n})\n// display add_vinyl route\nvinylRouter.get('/add_vinyls', ensureAuthenticated, (req, res) => {\n\n  res.render('add_vinyls');\n})\n\n\n// Single Item route client\nvinylRouter.get('/user/:id', (req, res) => {\n  Vinyl.findById(req.params.id, (err, vinyl) => {\n    User.findById(vinyl.author, (err, user) => { /*on rapl ici le user par son Id pour pouvoir display le user.name comme celui ayant enregistré l'entrée (le vinyl) dans la base de données*/\n      if(err){\n        console.log(err)\n      } else {\n      res.render('vinyl', {\n        vinyl:vinyl,\n        author:user.username /*on associe l'author(celui qui a enregistrer l'entrée dans la base de donnée au username du user qui a fait l'entrée)*/\n      });\n      }\n    })\n  });\n});\n\n// Formulaire Edit\nvinylRouter.get('/edit/:id', ensureAuthenticated, (req, res) => {\n  Vinyl.findById(req.params.id, (err, vinyl) => {\n    if(vinyl.author != req.user._id){\n      req.flash('danger', 'Not Authorized')\n      return res.redirect('/vinyls/user') /*ici il faut placer un return devant le res.redirect sinon l'api plante cf comment part 11 traversy Node.js from scratch*/\n    }\n    res.render('edit_vinyl', {\n      vinyl:vinyl\n    });\n  });\n});\n\n// Update Single Vinyl\nvinylRouter.post('/user/edit/:id', upload.single('cover'), (req, res) => {\n\n  let vinyl = req.body\n\nif(req.file){\n vinyl.cover=req.file.filename\n}\n else{\n   vinyl.cover=\"no cover\"\n }\n\n  let query = {_id:req.params.id};\n\n  Vinyl.update(query, vinyl, (err) => { /*ici on update le modèle du vinyl au lieu de sauver un objet*/\n  if(err){\n    console.log(err)\n  } else {\n    req.flash('success', 'Vinyl updated')\n    res.redirect('/vinyls/user')\n  }\n  })\n})\n\nvinylRouter.post('/user/delete/:id', (req, res) => {\n\n  Vinyl.remove({_id:req.params.id}, (err) => {\n    if(err){\n      console.log('ok')\n\n    } else {\n      req.flash('success', 'Vinyl deleted')\n      res.redirect('/vinyls/user')\n    }\n    })\n})\n\n// route User Collection\nvinylRouter.get('/user', ensureAuthenticated, (req, res) => {\n  Vinyl.find({author: req.user._id}, (err, userVinyls) => {\n    console.log(userVinyls)\n    res.render('profil', {\n      vinyls:userVinyls\n    });\n  })\n})\n\n// route All Users Collections\n// route User Collection\nvinylRouter.get('/', ensureAuthenticated, (req, res) => {\n  Vinyl.find({}, (err, allVinyls) => {\n    console.log(allVinyls)\n    res.render('profil', {\n      vinyls:allVinyls\n    });\n  })\n})\n\n// Access Control\n\nexport { vinylRouter }\n\n\n\n// WEBPACK FOOTER //\n// ./src/routes/vinyls.js","import mongoose from 'mongoose'\n\nconst Schema = mongoose.Schema\n\nconst VinylSchema = new Schema({\n  title       : {type: String},\n  artist      : {type: String, index: true},\n  release     : {type: String},\n  format      : {type: String},\n  description : {type: String},\n  cover       : {type: String},\n  author      : {type: String}\n\n})\n\nconst Vinyl = mongoose.model(\"Vinyl\", VinylSchema)\n\nexport{ Vinyl }\n\n\n\n// WEBPACK FOOTER //\n// ./src/models/vinyl.js","module.exports = require(\"express-validator/check\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"express-validator/check\"\n// module id = 19\n// module chunks = 0","module.exports = require(\"passport-local\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"passport-local\"\n// module id = 20\n// module chunks = 0","module.exports = require(\"express-messages\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"express-messages\"\n// module id = 21\n// module chunks = 0"],"sourceRoot":""}